summary(P_D)
sort(P_D)
#create a table
meres=c(mean(A,na.rm = TRUE),mean(B,na.rm = TRUE),mean(C,na.rm = TRUE),mean(D,na.rm = TRUE))
names(meres)=c("A","B","C","D")
meres
#write.csv(meres,file="pa_species_specific_route_level.csv")
#save results as datatable for further analysis
species=colnames(Y)
pa_results=data.frame(species,A,B,C,D)
setnames(pa_results,c("A","B","C","D"),c("pa_A","pa_B","pa_C","pa_D"))
write.csv(pa_results, "pa_results.csv",row.names = F)
pa_results
#kannanmuutostrendien tarkastelu, lasketaan kaikilta linjoilta ennustetut ja todelliset kannanmuutokset
Ap1<-as.data.frame(Ap1)
Ap2<-as.data.frame(Ap2)
Ay<-as.data.frame(Ay)
#aineisto, jossa kullekin lajille laskettu kaikilta linjoilta ennustettu ja todellinen muutoksen keskiarvo (EI siis korrelaatio
# ennusteiden ja oikeiden muutosten välillä kuten aiemmin on laskettu)
kat=colnames(Y)
kat=as.data.frame(kat)
kat$Ap1k=colMeans(Ap1,na.rm = T)
kat$Ap2k<-colMeans(Ap2,na.rm = T)
kat$Ayk<-colMeans(Ay,na.rm = T)
ggplot(kat, aes(x=Ap2k, y=Ayk))+ geom_point()+
geom_hline(yintercept = 0, color = "black")+
geom_vline(xintercept = 0, color = "black")+
xlab("Mean predicted change, C")+
ylab("Mean observed change")+
geom_abline(intercept = 0, slope = 1, color="red",linetype="dashed", size=1.5)+
geom_text(aes(label=kat),hjust=0, vjust=0) + geom_smooth(method=lm,se=F)
ggplot(kat, aes(x=Ap1k, y=Ayk))+
geom_point()+ geom_hline(yintercept = 0, color = "black")+
geom_vline(xintercept = 0, color = "black")+
xlab("Mean predicted change, D")+
ylab("Mean observed change")+
geom_abline(intercept = 0, slope = 1, color="red",linetype="dashed", size=1.5)+
geom_text(aes(label=kat),hjust=0, vjust=0)+  geom_smooth(method=lm,se=F)
#tallennetaan tarvittaessa
write.csv(kat,"mean_observed_predicted_changes_pa.csv",row.names = F)
modeltype = 2 #2 on abu-aineistolle
filename = file.path(PredictionDir, paste("predictions_",c("pa","abundance")[modeltype],                                    "_chains_",as.character(nChains),"_thin_", as.character(thin),"_samples_", as.character(samples),".Rdata",sep = ""))
load(filename) #mpred1, mpred2, Y, studyDesign
routes=levels(studyDesign$Route)
nr=length(routes)
years=levels(studyDesign$Year)
dim(mpred1)
ns=dim(mpred1)[2]
dim(mpred2)
dim(Y)
dim(studyDesign)
pm1p1=mpred1[period1,]
pm2p1=mpred2[period1,]
pm1p2=mpred1[period2,] #pm1p2 = predictions by model 1 to period 2
pm2p2=mpred2[period2,]
y1=Y[period1,]
y2=Y[period2,]
sd1 = studyDesign[period1,]
sd2 = studyDesign[period2,]
visits1 = rep(NA,nr)
visits2 = rep(NA,nr)
for (i in 1:nr){
visits1[i] = sum(sd1$Route==routes[i])
visits2[i] = sum(sd2$Route==routes[i])
}
# COMPUTE MEASURES A AND B
selroutes = routes[which(visits2>=2)]
nsr = length(selroutes)
Ap1=matrix(NA,nrow = nsr,ncol = ns)
Ap2=matrix(NA,nrow = nsr,ncol = ns)
Ay=matrix(NA,nrow = nsr,ncol = ns)
for (j in 1:ns) {
for (i in 1:nsr){
take = which(sd2$Route == selroutes[i] & y2[,j]>-1)
Ap1[i,j] = mean(pm1p2[take,j])
Ap2[i,j] = mean(pm2p2[take,j])
Ay[i,j] = mean(y2[take,j],na.rm=T)
}}
A = rep(NA,ns)
B = rep(NA,ns)
for (i in 1:ns){
A[i] = cor(Ap2[,i],Ay[,i],use="na.or.complete")   #lisäsin tähän määreen
B[i] = cor(Ap1[,i],Ay[,i],use="na.or.complete")
}
plot(A,B,xlim=c(-1,1), ylim=c(-1,1)) + abline(0,1)+ abline(h=0)+ abline(v=0)
# COMPUTE MEASURES C AND D
selroutes = routes[which(visits1>=2 & visits2>=2)]
nsr = length(selroutes)
Ap1=matrix(NA,nrow = nsr,ncol = ns)
Ap2=matrix(NA,nrow = nsr,ncol = ns)
Ay=matrix(NA,nrow = nsr,ncol = ns)
for (j in 1:ns){
for (i in 1:nsr){
take1 = which(sd1$Route == selroutes[i] & y1[,j]>-1)
take2 = which(sd2$Route == selroutes[i]& y2[,j]>-1)
Ap1[i,j] = mean(pm1p2[take2,j])-mean(pm1p1[take1,j]) #ka laskettava vain vuosilta, jolloin lajia on havaittu
Ap2[i,j] = mean(pm2p2[take2,j])-mean(pm2p1[take1,j]) #riittää, että on edes kerran pystytty laskemaan lajia
Ay[i,j] = mean(y2[take2,j],na.rm=T)- mean(y1[take1,j],na.rm=T) #NA:t eivät saa estää keskiarvon laskemista koko lajille.
}}
C = rep(NA,ns)
D = rep(NA,ns)
for (i in 1:ns){
C[i] = cor(Ap2[,i],Ay[,i],use="na.or.complete")    #lisäsin tähän määreen
D[i] = cor(Ap1[,i],Ay[,i],use="na.or.complete")
}
plot(C,D,xlim=c(-1,1), ylim=c(-1,1)) + abline(0,1)+ abline(h=0)+ abline(v=0)
meres=c(mean(A,na.rm = TRUE),mean(B,na.rm = TRUE),mean(C,na.rm = TRUE),mean(D,na.rm = TRUE))
names(meres)=c("A","B","C","D")
meres
#save as datatable
species=colnames(Y)
abu_results=data.frame(species,A,B,C,D)
setnames(abu_results,c("A","B","C","D"),c("abu_A","abu_B","abu_C","abu_D"))
write.csv(abu_results, "abu_results.csv",row.names = F)
#combine data frames
res=inner_join(pa_results,abu_results,by="species")
#save as csv for further analysis
write.csv(res,"results.csv",row.names = F)
abu_results
pred=Ap1[,21]
obs=Ay[,21]
laji=as.data.frame(cbind(pred,obs))
#tarkistus
cor(pred,obs, use="na.or.complete")
#kuvaaja
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-2,2)+ylim(-2,2)+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("Viherpeippo")
#entäpä pohjansirkku?
pred=Ap1[,40]
obs=Ay[,40]
laji=as.data.frame(cbind(pred,obs))
#tarkistus
cor(pred,obs, use="na.or.complete")
#kuvaaja
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-2,2)+ylim(-2,2)+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("Pohjansirkku")
P_D = rep(NA,ns)
for (i in 1:ns){
P_D[i] = pairwiseCount(Ap1[,i],Ay[,i])
}
summary(P_D)
sort(P_D)
res=cbind(res,P_D)
View(res)
#save as csv for further analysis
write.csv(res,"results.csv",row.names = F)
knitr::opts_chunk$set(echo = TRUE)
packages<-c("readr","tidyr","dplyr","plyr","magrittr","purrr","data.table","plotrix","jtools","ggplot2","lme4","nlme")
lapply(packages,library,character.only=T)
getwd()
res<-read.csv("results.csv",header=T,sep=",")
str(res)
res$abu_Dx=res$abu_D
str(res)
res$abu_Dx[res$P_D<5]=NA
View(res)
res$abu_D[res$P_D<5]=NA
res3=res
getwd()
paketit<-c("readr","tidyr","plyr","dplyr","vegan","ggplot2","lattice","psych","glmmTMB","lme4","MASS")
lapply(paketit,library,character.only=T)
source("HighstatLibV12.R")
data<-read.csv("OrtolanBunting.csv")
#tarkasta kaikkien luokkien muoto
data$id<-as.factor(data$id)
#pitäisikö vuosi olla factor vai integer?
data$fyear<-as.factor(data$year)
names(data)
summary(data)
str(data)
#outliers
dotchart(data$terri, main= "territories")
dotchart(data$prec, main= "precipitation")
dotchart(data$temp, main= "temperature")
dotchart(data$open, main= "spring sown")
dotchart(data$SSS, main= "small-scale structures")
hist(data$terri)
#kuinka monta käyntikertaa per osapopulaatio?
table(data$id)
#relationships
pairs.panels(data[,c(4:7,8:9,21:23,28:30)])
#plottailua
xyplot(terri~year|id, data=data)
boxplot(terri~year, data=data)
boxplot(terri~id, data=data)
xyplot(terri~SSS, data=data)
xyplot(terri~open, data=data)
xyplot(terri~cover, data=data)
#esimerkit:
#m1=glmmTMB(N ~Year + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m2=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m3=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Temp + Year*Rain + Year*NDVI + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m4=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Cropdiv + Year*Plough + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m5=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Temp + Year*Rain + Year*NDVI + Year*Cropdiv + Year*Plough + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#varsinaiset mallit:
M1=glmmTMB(terri ~ year + (1|fyear) + (1|id), family=nbinom2, data=data)
summary(M1)
#M2=glmmTMB(terri ~ SSS + agri5 +  X*Y + year + (1|fyear) + (1|id), family=nbinom2, data=data)
#summary(M2)
#M3=glmmTMB(terri ~ SSS + agri5 +  X*Y + year*temp + year*prec + year*ndvi  + (1|fyear) + (1|id), family=nbinom2, data=data)  #tästä ehkä ndvi pois?
#summary(M3)
#M4=glmmTMB(terri ~ SSS + agri5 +  X*Y + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=data)
#summary(M4)
#M5=glmmTMB(terri ~ SSS + agri5  + X*Y + year*temp + year*prec + year*ndvi + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=data)
#summary(M5)
paketit<-c("readr","tidyr","plyr","dplyr","vegan","ggplot2","lattice","psych","glmmTMB","lme4","MASS","MuMIn")
lapply(paketit,library,character.only=T)
output1<-model.sel(M1,M2,M3,M4,M5)
M1=glmmTMB(terri ~ year + (1|fyear)+ (1|id), family=nbinom2, data=dataS)
#Pitäisikö aineisto skaalata?
dataS=data %>%
mutate_at(c(2,4,5,6,7,9:30), funs(c(scale(.))))
M1=glmmTMB(terri ~ year + (1|fyear)+ (1|id), family=nbinom2, data=dataS)
M1=glmmTMB(terri ~ year + (1|fyear)+ (1|id), family=nbinom2, data=dataS)
M2=glmmTMB(terri ~ SSS + agri5 + X*Y + year + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M3=glmmTMB(terri ~ SSS + agri5 + X*Y + year*temp + year*prec  + (1|fyear)  + (1|id), family=nbinom2, data=dataS)
M4=glmmTMB(terri ~ SSS + agri5 + X*Y + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M5=glmmTMB(terri ~ SSS + agri5 + X*Y + year*temp + year*prec + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
output1<-model.sel(M1,M2,M3,M4,M5)
# AICc Table
output1
#tehdään model averaging
summary(model.avg(output1, revised.var = TRUE))
summary(M4)
summary(M5)
M6=glmmTMB(terri ~ SSS + agri5 + X+ Y + year + temp + prec + shan + open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
summary(M6)
M7=glmmTMB(terri ~ SSS + agri5 + Y + year  + shan  + (1|fyear) + (1|id), family=nbinom2, data=dataS)
summary(M7)
M7=glmmTMB(terri ~ agri5 + Y + year  + shan  + (1|fyear) + (1|id), family=nbinom2, data=dataS)
summary(M7)
summary(M5)
AIC(M6,M7)
M6=glmmTMB(terri ~ SSS + agri5 + X + Y + year + temp + prec + shan + open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M7=glmmTMB(terri ~ agri5 + X + Y + year + temp + prec + shan  + (1|fyear) + (1|id), family=nbinom2, data=dataS)
AIC(M6,M7)
M8=glmmTMB(terri ~ agri5 + X + Y + year + temp + shan  + (1|fyear) + (1|id), family=nbinom2, data=dataS)
AIC(M7,M8)
M9=glmmTMB(terri ~ agri5 + X + Y + year + shan  + (1|fyear) + (1|id), family=nbinom2, data=dataS)
AIC(M8,M9)
M10=glmmTMB(terri ~ agri5  + Y + year + shan  + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M10=glmmTMB(terri ~ agri5  + Y + year + shan  + (1|fyear) + (1|id), family=nbinom2, data=dataS)
AIC(M9,M10)
M11=glmmTMB(terri ~ agri5  + year + shan  + (1|fyear) + (1|id), family=nbinom2, data=dataS)
AIC(M10,M11)
M12=glmmTMB(terri ~ Y + year + shan  + (1|fyear) + (1|id), family=nbinom2, data=dataS)
AIC(M10,M12)
M10=glmmTMB(terri ~ agri5  + Y + year   + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M10=glmmTMB(terri ~ agri5  + Y + year + shan  + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M13=glmmTMB(terri ~ agri5  + Y + year   + (1|fyear) + (1|id), family=nbinom2, data=dataS)
AIC(M10,M13)
M14=glmmTMB(terri ~ agri5  + Y  + shan  + (1|fyear) + (1|id), family=nbinom2, data=dataS)
AIC(M10,M14)
#neot erikseen
M.neo=glmmTMB(terri ~ neo * year + X * Y + (1|fyear) + (1|id), family=nbinom2, data=dataS)
summary(m.neo)
summary(M.neo)
#neot erikseen
N1=glmmTMB(terri ~ neo * year + X * Y + (1|fyear) + (1|id), family=nbinom2, data=dataS)
#neot erikseen
N1=glmmTMB(terri ~ neo * year + X * Y + (1|fyear) + (1|id), family=nbinom2, data=dataS)
summary(N1)
N2=glmmTMB(terri ~ neo + year + X + Y + (1|fyear) + (1|id), family=nbinom2, data=dataS)
N2=glmmTMB(terri ~ neo + year + X + Y + (1|fyear) + (1|id), family=nbinom2, data=dataS)
N3=glmmTMB(terri ~ neo + year  + Y + (1|fyear) + (1|id), family=nbinom2, data=dataS)
AIC(N2,N3)
AIC(N1,N2)
AIC(N2,N3)
N4=glmmTMB(terri ~ neo + Y + (1|fyear) + (1|id), family=nbinom2, data=dataS)
AIC(N3,N4)
N5=glmmTMB(terri ~ neo + year + X  + (1|fyear) + (1|id), family=nbinom2, data=dataS)
AIC(N3,N5)
summary(N3)
N5=glmmTMB(terri ~ neo + year  + (1|fyear) + (1|id), family=nbinom2, data=dataS)
AIC(N3,N5)
N6=glmmTMB(terri ~  year + Y + (1|fyear) + (1|id), family=nbinom2, data=dataS)
AIC(N3,N6)
summary(N6)
summary(N3)
getwd()
paketit<-c("readr","tidyr","plyr","dplyr","vegan","ggplot2","lattice","psych","glmmTMB","lme4","MASS","MuMIn")
lapply(paketit,library,character.only=T)
data<-read.csv("OrtolanBunting.csv")
#tarkasta kaikkien luokkien muoto
data$id<-as.factor(data$id)
#pitäisikö vuosi olla factor vai integer?
data$fyear<-as.factor(data$year)
names(data)
summary(data)
str(data)
#outliers
dotchart(data$terri, main= "territories")
dotchart(data$prec, main= "precipitation")
dotchart(data$temp, main= "temperature")
dotchart(data$open, main= "spring sown")
dotchart(data$SSS, main= "small-scale structures")
hist(data$terri)
#kuinka monta käyntikertaa per osapopulaatio?
table(data$id)
#relationships
pairs.panels(data[,c(4:7,8:9,21:23,28:30)])
#plottailua
xyplot(terri~year|id, data=data)
boxplot(terri~year, data=data)
boxplot(terri~id, data=data)
xyplot(terri~SSS, data=data)
xyplot(terri~open, data=data)
xyplot(terri~cover, data=data)
#esimerkit:
#m1=glmmTMB(N ~Year + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m2=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m3=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Temp + Year*Rain + Year*NDVI + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m4=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Cropdiv + Year*Plough + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m5=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Temp + Year*Rain + Year*NDVI + Year*Cropdiv + Year*Plough + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#varsinaiset mallit:
M1=glmmTMB(terri ~ year + (1|fyear) + (1|id), family=nbinom2, data=data)
summary(M1)
#M2=glmmTMB(terri ~ SSS + agri5 +  X*Y + year + (1|fyear) + (1|id), family=nbinom2, data=data)
#summary(M2)
#M3=glmmTMB(terri ~ SSS + agri5 +  X*Y + year*temp + year*prec + year*ndvi  + (1|fyear) + (1|id), family=nbinom2, data=data)  #tästä ehkä ndvi pois?
#summary(M3)
#M4=glmmTMB(terri ~ SSS + agri5 +  X*Y + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=data)
#summary(M4)
#M5=glmmTMB(terri ~ SSS + agri5  + X*Y + year*temp + year*prec + year*ndvi + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=data)
#summary(M5)
dataS=data %>%
mutate_at(c(2,4,5,6,7,9:30), funs(c(scale(.))))
M1=glmmTMB(terri ~ year + (1|fyear)+ (1|id), family=nbinom2, data=dataS)
M2=glmmTMB(terri ~ SSS + agri5 + X*Y + year + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M3=glmmTMB(terri ~ SSS + agri5 + X*Y + year*temp + year*prec  + (1|fyear)  + (1|id), family=nbinom2, data=dataS)
M4=glmmTMB(terri ~ SSS + agri5 + X*Y + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M5=glmmTMB(terri ~ SSS + agri5 + X*Y + year*temp + year*prec + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
output1<-model.sel(M1,M2,M3,M4,M5)
# AICc Table
output1
summary(M4)
#tehdään model averaging
summary(model.avg(output1, revised.var = TRUE))
#tehdään model averaging
summary(model.avg(output1, revised.var = TRUE))
output2=model.sel(M4,M5)
#tehdään model averaging
summary(model.avg(output2, revised.var = TRUE))
getwd()
paketit<-c("readr","tidyr","plyr","dplyr","vegan","ggplot2","lattice","psych","glmmTMB","lme4","MASS","MuMIn")
lapply(paketit,library,character.only=T)
data<-read.csv("OrtolanBunting.csv")
#tarkasta kaikkien luokkien muoto
data$id<-as.factor(data$id)
#pitäisikö vuosi olla factor vai integer?
data$fyear<-as.factor(data$year)
names(data)
summary(data)
str(data)
#outliers
dotchart(data$terri, main= "territories")
dotchart(data$prec, main= "precipitation")
dotchart(data$temp, main= "temperature")
dotchart(data$open, main= "spring sown")
dotchart(data$SSS, main= "small-scale structures")
hist(data$terri)
#kuinka monta käyntikertaa per osapopulaatio?
table(data$id)
#relationships
pairs.panels(data[,c(4:7,8:9,21:23,28:30)])
#plottailua
xyplot(terri~year|id, data=data)
boxplot(terri~year, data=data)
boxplot(terri~id, data=data)
xyplot(terri~SSS, data=data)
xyplot(terri~open, data=data)
xyplot(terri~cover, data=data)
#Aksun esimerkit (näissä mukana NDVI):
#m1=glmmTMB(N ~Year + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m2=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m3=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Temp + Year*Rain + Year*NDVI + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m4=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Cropdiv + Year*Plough + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m5=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Temp + Year*Rain + Year*NDVI + Year*Cropdiv + Year*Plough + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
a=c(1,3,5,8)
a
scale(a)
b=scale(a)
b
b
View(b)
mean(a)
sd(a)
1/sd(a)
3.25/sd(a)
getwd()
paketit<-c("readr","tidyr","plyr","dplyr","vegan","ggplot2","lattice","psych","glmmTMB","lme4","MASS","MuMIn")
lapply(paketit,library,character.only=T)
data<-read.csv("OrtolanBunting.csv")
#tarkasta kaikkien luokkien muoto
data$id<-as.factor(data$id)
#pitäisikö vuosi olla factor vai integer?
data$fyear<-as.factor(data$year)
names(data)
summary(data)
str(data)
#outliers
dotchart(data$terri, main= "territories")
dotchart(data$prec, main= "precipitation")
dotchart(data$temp, main= "temperature")
dotchart(data$open, main= "spring sown")
dotchart(data$SSS, main= "small-scale structures")
hist(data$terri)
#kuinka monta käyntikertaa per osapopulaatio?
table(data$id)
#relationships
pairs.panels(data[,c(4:7,8:9,21:23,28:30)])
#plottailua
xyplot(terri~year|id, data=data)
boxplot(terri~year, data=data)
boxplot(terri~id, data=data)
xyplot(terri~SSS, data=data)
xyplot(terri~open, data=data)
xyplot(terri~cover, data=data)
#Aksun esimerkit (näissä mukana NDVI):
#m1=glmmTMB(N ~Year + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m2=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m3=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Temp + Year*Rain + Year*NDVI + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m4=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Cropdiv + Year*Plough + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m5=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Temp + Year*Rain + Year*NDVI + Year*Cropdiv + Year*Plough + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
M1=glmmTMB(terri ~ year + (1|fyear)+ (1|id), family=nbinom2, data=dataS)
#Pitäisikö aineisto skaalata?
dataS=data %>%
mutate_at(c(2,4,5,6,7,9:30), funs(c(scale(.))))
M1=glmmTMB(terri ~ year + (1|fyear)+ (1|id), family=nbinom2, data=dataS)
M1=glmmTMB(terri ~ year + (1|fyear)+ (1|id), family=nbinom2, data=dataS)
M2=glmmTMB(terri ~ SSS + agri5 + X*Y + year + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M2=glmmTMB(terri ~ SSS + agri5 + X*Y + year + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M3=glmmTMB(terri ~ SSS + agri5 + X*Y + year*temp + year*prec  + (1|fyear)  + (1|id), family=nbinom2, data=dataS)
M4=glmmTMB(terri ~ SSS + agri5 + X*Y + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M5=glmmTMB(terri ~ SSS + agri5 + X*Y + year*temp + year*prec + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
output1<-model.sel(M1,M2,M3,M4,M5)
# AICc Table
output1
output2=model.sel(M4,M5)
#tehdään model averaging
summary(model.avg(output2, revised.var = TRUE))
summary(M5)
summary(M4)
paketit<-c("readr","tidyr","plyr","dplyr","vegan","ggplot2","lattice","psych","glmmTMB","lme4","MASS","MuMIn","mgcv")
lapply(paketit,library,character.only=T)
knitr::opts_chunk$set(echo = TRUE)
paketit<-c("readr","tidyr","plyr","dplyr","vegan","ggplot2")
lapply(paketit,library,character.only=T)
getwd()
localDir = "."
DataDir = file.path(localDir, "data")
filename1 = file.path(DataDir, "osapop_20002018.csv")
filename2= file.path(DataDir,"keskipisteiden_koordinaatit.csv")
data=read.csv(filename1, sep=";")
koord=read.csv(filename2, sep=";")
names(data)
head(koord)
#lisataan shannon-wiener muuttuja
data<-mutate(data, shan = diversity(data[,15:248],index="shannon"))
#kasvilajien lukumaara
data<-mutate(data, snum= rowSums(data[,15:248]>0))
#listataan ensi mita muuttujia menee mihinkin ryhmaan
eitietoa<-c("X99999")
avomaavih<-c("X5148","X3210","X50","X55","X3110","X3120","X3130","X3140","X3150","X3160","X3180","X3190","X3310","X5100","X5103","X5104","X5105","X5106","X5107","X5108","X5109","X5111","X5112","X5113","X5115","X5116","X5117","X5119","X5120","X5121","X5124","X5125","X5128","X5129","X5134","X5140","X5143","X5146","X5149","X5150","X5157","X5165","X5173","X5197","X5198","X5816","X9630")
erikois<-c("X4900","X4901","X4902","X4903","X4904","X9640","X9642") #lähinnä ruokohelpi (4900)
marjat<-c("X5210","X5213","X5220","X5221","X5301","X5302","X5303","X5304","X5307","X5310","X5311","X5318","X5319","X5400","X5410","X5420","X5441","X5451","X5500","X5510","X5512","X5530","X5534","X7210")
viljat<-c("X5853","X5831","X1211","X2190","X2195","X1140","X10","X1120","X1142","X1210","X1220","X1310","X1320","X1330","X1400","X1510","X1540","X1545","X1600","X1601","X1602","X1603","X1605","X1700","X1750","X1800","X1810","X1900")
mausteet<-c("X4800","X4810","X5152","X5806","X5824","X5842","X5843","X5846","X5850","X5851")
nurmet<-c("X6051","X2420","X2196","X2197","X9050","X9060","X9061","X9421","X94","X95","X90","X63","X60","X6050","X6060","X6111","X6112","X6113","X6114","X6121","X6122","X6123","X6124","X6125","X6210","X6220","X6221","X6230","X6300","X6301","X6302","X6400","X6402","X6542","X6545","X6550","X6561","X6562","X6563","X6565","X6600","X6700","X6710","X6720","X7110","X9100","X9101","X9102","X9110","X9111","X9400","X9401","X9402","X9403","X9404","X9405","X9406","X9407","X9408","X9412","X9413","X9422","X9423","X9424","X9430","X9440","X9460","X9600","X9620","X9700","X9710","X9720","X9801","X9810","X9811","X9812","X9800","X9820","X9802","X9803",	"X9804","X9805",	"X9806","X9807","X9808")
syysviljat<-c("X1110","X1141","X1230","X4120","X4220")
valkuais<-c("X2110","X2120","X2130","X2140","X2150","X2160","X2180","X2185","X2200","X2400","X2410","X2430","X2500","X2600","X5101","X5102")
oljy<-c("X4390","X4030","X4110","X4210","X4300","X4520","X4530","X4610","X4620","X8021")
#jos halutaan potentiaaliset neonikotinoidikasvit erikseen
neot<-c("X4110","X4120","X4210","X4220","X3210")
#valitaan ketjun perusteella sarakkeet ja lasketaan niistä summa uuden sarakkeen alle
data %>% select(avomaavih) %>% rowSums(na.rm=TRUE) -> data$vege
#valitaan ketjun perusteella sarakkeet ja lasketaan niistä summa uuden sarakkeen alle
data %>% select(avomaavih) %>% rowSums(na.rm=TRUE) -> data$vege
paketit<-c("readr","tidyr","dplyr","plyr","vegan","ggplot2")
lapply(paketit,library,character.only=T)
#valitaan ketjun perusteella sarakkeet ja lasketaan niistä summa uuden sarakkeen alle
data %>% select(avomaavih) %>% rowSums(na.rm=TRUE) -> data$vege
paketit<-c("readr","dplyr","vegan","ggplot2")
knitr::opts_chunk$set(echo = TRUE)
paketit<-c("readr","dplyr","vegan","ggplot2")
lapply(paketit,library,character.only=T)
getwd()
localDir = "."
DataDir = file.path(localDir, "data")
filename1 = file.path(DataDir, "osapop_20002018.csv")
filename2= file.path(DataDir,"keskipisteiden_koordinaatit.csv")
data=read.csv(filename1, sep=";")
koord=read.csv(filename2, sep=";")
names(data)
head(koord)
#lisataan shannon-wiener muuttuja
data<-mutate(data, shan = diversity(data[,15:248],index="shannon"))
#kasvilajien lukumaara
data<-mutate(data, snum= rowSums(data[,15:248]>0))
#listataan ensi mita muuttujia menee mihinkin ryhmaan
eitietoa<-c("X99999")
avomaavih<-c("X5148","X3210","X50","X55","X3110","X3120","X3130","X3140","X3150","X3160","X3180","X3190","X3310","X5100","X5103","X5104","X5105","X5106","X5107","X5108","X5109","X5111","X5112","X5113","X5115","X5116","X5117","X5119","X5120","X5121","X5124","X5125","X5128","X5129","X5134","X5140","X5143","X5146","X5149","X5150","X5157","X5165","X5173","X5197","X5198","X5816","X9630")
erikois<-c("X4900","X4901","X4902","X4903","X4904","X9640","X9642") #lähinnä ruokohelpi (4900)
marjat<-c("X5210","X5213","X5220","X5221","X5301","X5302","X5303","X5304","X5307","X5310","X5311","X5318","X5319","X5400","X5410","X5420","X5441","X5451","X5500","X5510","X5512","X5530","X5534","X7210")
viljat<-c("X5853","X5831","X1211","X2190","X2195","X1140","X10","X1120","X1142","X1210","X1220","X1310","X1320","X1330","X1400","X1510","X1540","X1545","X1600","X1601","X1602","X1603","X1605","X1700","X1750","X1800","X1810","X1900")
mausteet<-c("X4800","X4810","X5152","X5806","X5824","X5842","X5843","X5846","X5850","X5851")
nurmet<-c("X6051","X2420","X2196","X2197","X9050","X9060","X9061","X9421","X94","X95","X90","X63","X60","X6050","X6060","X6111","X6112","X6113","X6114","X6121","X6122","X6123","X6124","X6125","X6210","X6220","X6221","X6230","X6300","X6301","X6302","X6400","X6402","X6542","X6545","X6550","X6561","X6562","X6563","X6565","X6600","X6700","X6710","X6720","X7110","X9100","X9101","X9102","X9110","X9111","X9400","X9401","X9402","X9403","X9404","X9405","X9406","X9407","X9408","X9412","X9413","X9422","X9423","X9424","X9430","X9440","X9460","X9600","X9620","X9700","X9710","X9720","X9801","X9810","X9811","X9812","X9800","X9820","X9802","X9803",	"X9804","X9805",	"X9806","X9807","X9808")
syysviljat<-c("X1110","X1141","X1230","X4120","X4220")
valkuais<-c("X2110","X2120","X2130","X2140","X2150","X2160","X2180","X2185","X2200","X2400","X2410","X2430","X2500","X2600","X5101","X5102")
oljy<-c("X4390","X4030","X4110","X4210","X4300","X4520","X4530","X4610","X4620","X8021")
#jos halutaan potentiaaliset neonikotinoidikasvit erikseen
neot<-c("X4110","X4120","X4210","X4220","X3210")
#valitaan ketjun perusteella sarakkeet ja lasketaan niistä summa uuden sarakkeen alle
data %>% select(avomaavih) %>% rowSums(na.rm=TRUE) -> data$vege
