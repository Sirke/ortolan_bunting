mausteet<-c("X4800","X4810","X5152","X5806","X5824","X5842","X5843","X5846","X5850","X5851")
nurmet<-c("X6051","X2420","X2196","X2197","X9050","X9060","X9061","X9421","X94","X95","X90","X63","X60","X6050","X6060","X6111","X6112","X6113","X6114","X6121","X6122","X6123","X6124","X6125","X6210","X6220","X6221","X6230","X6300","X6301","X6302","X6400","X6402","X6542","X6545","X6550","X6561","X6562","X6563","X6565","X6600","X6700","X6710","X6720","X7110","X9100","X9101","X9102","X9110","X9111","X9400","X9401","X9402","X9403","X9404","X9405","X9406","X9407","X9408","X9412","X9413","X9422","X9423","X9424","X9430","X9440","X9460","X9600","X9620","X9700","X9710","X9720","X9801","X9810","X9811","X9812","X9800","X9820","X9802","X9803",	"X9804","X9805",	"X9806","X9807","X9808")
syysviljat<-c("X1110","X1141","X1230","X4120","X4220")
valkuais<-c("X2110","X2120","X2130","X2140","X2150","X2160","X2180","X2185","X2200","X2400","X2410","X2430","X2500","X2600","X5101","X5102")
oljy<-c("X4390","X4030","X4110","X4210","X4300","X4520","X4530","X4610","X4620","X8021")
#jos halutaan potentiaaliset neonikotinoidikasvit erikseen
neot<-c("X4110","X4120","X4210","X4220","X3210")
#valitaan ketjun perusteella sarakkeet ja lasketaan niistä summa uuden sarakkeen alle
data %>% dplyr::select(avomaavih) %>% rowSums(na.rm=TRUE) -> data$vege
data %>% dplyr::select(eitietoa) %>% rowSums(na.rm=TRUE) -> data$unkno
data %>% dplyr::select(erikois) %>% rowSums(na.rm=TRUE) -> data$spec
data %>% dplyr::select(marjat) %>% rowSums(na.rm=TRUE) -> data$fruit
data %>% dplyr::select(viljat) %>% rowSums(na.rm=TRUE) -> data$cere
data %>% dplyr::select(mausteet) %>% rowSums(na.rm=TRUE) -> data$herb
data %>% dplyr::select(nurmet) %>% rowSums(na.rm=TRUE) -> data$gras
data %>% dplyr::select(syysviljat) %>% rowSums(na.rm=TRUE) -> data$wint
data %>% dplyr::select(valkuais) %>% rowSums(na.rm=TRUE) -> data$prot
data %>% dplyr::select(oljy) %>% rowSums(na.rm=TRUE) -> data$oil
#neo erikseen
data %>% dplyr::select(neot) %>% rowSums(na.rm=TRUE) -> data$neo
#viljelykasvien keskimääräiset osuudet kaikilta vuosilta
osuudet<-colMeans(data[,15:248])
sp<-names(data[,15:248])
sp<- as.data.frame((cbind(sp,osuudet)),row.names = F)
sp$osuudet<-as.numeric(as.character(sp$osuudet))
#viljelykasvien pinta-alojen jakauma
ggplot(sp, aes(x=osuudet))+geom_histogram()
#yleisimmät viljelykasvit
sp %>%
top_n(10, osuudet)
#kasviryhmien keskimääräiset osuudet kaikilta vuosilta
colMeans(data[,251:260])
#jos halutaan vielä tiivistää viljelykasveja
data<-mutate(data, open = cere+vege+oil+prot) #pitäisikö vielä lisätä herb, fruit ja spec (ruokohelpi)? entäpä 9999?
data<-mutate(data, cover = gras+wint)
#muutetaan area neliökilometreiksi
data$area=data$area/1000000
data<-mutate(data, Abuild = build/area)
data<-mutate(data, Ariver = river/area)
data<-mutate(data, Astream = stream/area)
data<-mutate(data, Aroad = roads/area)
data<-mutate(data, SSS = Abuild+Aroad+Ariver+Astream)
names(data)
data<-data[,c(1:2,4:5,7:8,12:13,249:250,261:266)]
#koordinaatit
koord=select(koord,id,X,Y)
#koordinaatit
koord=dplyr::select(koord,id,X,Y)
data<-left_join(data,koord,by="id")
names(data)
#poista aineistosta paikat, joilla ei ole kayty
data=data %>% drop_na("terri")
#tallennetaan
write.csv(data,"OrtolanBunting.csv",row.names = F)
getwd()
paketit<-c("readr","tidyr","plyr","dplyr","vegan","ggplot2","lattice","psych","glmmTMB","lme4","MASS","MuMIn","mgcv")
lapply(paketit,library,character.only=T)
data<-read.csv("OrtolanBunting.csv")
names(data)
str(data)
knitr::opts_chunk$set(echo = TRUE)
paketit<-c("readr","dplyr","vegan","ggplot2","tidyr")
lapply(paketit,library,character.only=T)
getwd()
localDir = "."
DataDir = file.path(localDir, "data")
filename1 = file.path(DataDir, "osapop_20002018.csv")
filename2= file.path(DataDir,"keskipisteiden_koordinaatit.csv")
data=read.csv(filename1, sep=";")
koord=read.csv(filename2, sep=";")
names(data)
head(koord)
#lisataan shannon-wiener muuttuja
data<-mutate(data, shan = diversity(data[,15:248],index="shannon"))
#kasvilajien lukumaara
data<-mutate(data, snum= rowSums(data[,15:248]>0))
#listataan ensi mita muuttujia menee mihinkin ryhmaan
eitietoa<-c("X99999")
avomaavih<-c("X5148","X3210","X50","X55","X3110","X3120","X3130","X3140","X3150","X3160","X3180","X3190","X3310","X5100","X5103","X5104","X5105","X5106","X5107","X5108","X5109","X5111","X5112","X5113","X5115","X5116","X5117","X5119","X5120","X5121","X5124","X5125","X5128","X5129","X5134","X5140","X5143","X5146","X5149","X5150","X5157","X5165","X5173","X5197","X5198","X5816","X9630")
erikois<-c("X4900","X4901","X4902","X4903","X4904","X9640","X9642") #lähinnä ruokohelpi (4900)
marjat<-c("X5210","X5213","X5220","X5221","X5301","X5302","X5303","X5304","X5307","X5310","X5311","X5318","X5319","X5400","X5410","X5420","X5441","X5451","X5500","X5510","X5512","X5530","X5534","X7210")
viljat<-c("X5853","X5831","X1211","X2190","X2195","X1140","X10","X1120","X1142","X1210","X1220","X1310","X1320","X1330","X1400","X1510","X1540","X1545","X1600","X1601","X1602","X1603","X1605","X1700","X1750","X1800","X1810","X1900")
mausteet<-c("X4800","X4810","X5152","X5806","X5824","X5842","X5843","X5846","X5850","X5851")
nurmet<-c("X6051","X2420","X2196","X2197","X9050","X9060","X9061","X9421","X94","X95","X90","X63","X60","X6050","X6060","X6111","X6112","X6113","X6114","X6121","X6122","X6123","X6124","X6125","X6210","X6220","X6221","X6230","X6300","X6301","X6302","X6400","X6402","X6542","X6545","X6550","X6561","X6562","X6563","X6565","X6600","X6700","X6710","X6720","X7110","X9100","X9101","X9102","X9110","X9111","X9400","X9401","X9402","X9403","X9404","X9405","X9406","X9407","X9408","X9412","X9413","X9422","X9423","X9424","X9430","X9440","X9460","X9600","X9620","X9700","X9710","X9720","X9801","X9810","X9811","X9812","X9800","X9820","X9802","X9803",	"X9804","X9805",	"X9806","X9807","X9808")
syysviljat<-c("X1110","X1141","X1230","X4120","X4220")
valkuais<-c("X2110","X2120","X2130","X2140","X2150","X2160","X2180","X2185","X2200","X2400","X2410","X2430","X2500","X2600","X5101","X5102")
oljy<-c("X4390","X4030","X4110","X4210","X4300","X4520","X4530","X4610","X4620","X8021")
#jos halutaan potentiaaliset neonikotinoidikasvit erikseen
neot<-c("X4110","X4120","X4210","X4220","X3210")
#valitaan ketjun perusteella sarakkeet ja lasketaan niistä summa uuden sarakkeen alle
data %>% dplyr::select(avomaavih) %>% rowSums(na.rm=TRUE) -> data$vege
data %>% dplyr::select(eitietoa) %>% rowSums(na.rm=TRUE) -> data$unkno
data %>% dplyr::select(erikois) %>% rowSums(na.rm=TRUE) -> data$spec
data %>% dplyr::select(marjat) %>% rowSums(na.rm=TRUE) -> data$fruit
data %>% dplyr::select(viljat) %>% rowSums(na.rm=TRUE) -> data$cere
data %>% dplyr::select(mausteet) %>% rowSums(na.rm=TRUE) -> data$herb
data %>% dplyr::select(nurmet) %>% rowSums(na.rm=TRUE) -> data$gras
data %>% dplyr::select(syysviljat) %>% rowSums(na.rm=TRUE) -> data$wint
data %>% dplyr::select(valkuais) %>% rowSums(na.rm=TRUE) -> data$prot
data %>% dplyr::select(oljy) %>% rowSums(na.rm=TRUE) -> data$oil
#neo erikseen
data %>% dplyr::select(neot) %>% rowSums(na.rm=TRUE) -> data$neo
#viljelykasvien keskimääräiset osuudet kaikilta vuosilta
osuudet<-colMeans(data[,15:248])
sp<-names(data[,15:248])
sp<- as.data.frame((cbind(sp,osuudet)),row.names = F)
sp$osuudet<-as.numeric(as.character(sp$osuudet))
#viljelykasvien pinta-alojen jakauma
ggplot(sp, aes(x=osuudet))+geom_histogram()
#yleisimmät viljelykasvit
sp %>%
top_n(10, osuudet)
#kasviryhmien keskimääräiset osuudet kaikilta vuosilta
colMeans(data[,251:260])
#jos halutaan vielä tiivistää viljelykasveja
data<-mutate(data, open = cere+vege+oil+prot) #pitäisikö vielä lisätä herb, fruit ja spec (ruokohelpi)? entäpä 9999?
data<-mutate(data, cover = gras+wint)
#muutetaan area neliökilometreiksi
data$area=data$area/1000000
data<-mutate(data, Abuild = build/area)
data<-mutate(data, Ariver = river/area)
data<-mutate(data, Astream = stream/area)
data<-mutate(data, Aroad = roads/area)
names(data)
data<-mutate(data, SSS = Abuild+Aroad+Ariver+Astream)
knitr::opts_chunk$set(echo = TRUE)
paketit<-c("readr","dplyr","vegan","ggplot2","tidyr")
lapply(paketit,library,character.only=T)
getwd()
localDir = "."
DataDir = file.path(localDir, "data")
filename1 = file.path(DataDir, "osapop_20002018.csv")
filename2= file.path(DataDir,"keskipisteiden_koordinaatit.csv")
data=read.csv(filename1, sep=";")
koord=read.csv(filename2, sep=";")
names(data)
head(koord)
#lisataan shannon-wiener muuttuja
data<-mutate(data, shan = diversity(data[,15:248],index="shannon"))
#kasvilajien lukumaara
data<-mutate(data, snum= rowSums(data[,15:248]>0))
#listataan ensi mita muuttujia menee mihinkin ryhmaan
eitietoa<-c("X99999")
avomaavih<-c("X5148","X3210","X50","X55","X3110","X3120","X3130","X3140","X3150","X3160","X3180","X3190","X3310","X5100","X5103","X5104","X5105","X5106","X5107","X5108","X5109","X5111","X5112","X5113","X5115","X5116","X5117","X5119","X5120","X5121","X5124","X5125","X5128","X5129","X5134","X5140","X5143","X5146","X5149","X5150","X5157","X5165","X5173","X5197","X5198","X5816","X9630")
erikois<-c("X4900","X4901","X4902","X4903","X4904","X9640","X9642") #lähinnä ruokohelpi (4900)
marjat<-c("X5210","X5213","X5220","X5221","X5301","X5302","X5303","X5304","X5307","X5310","X5311","X5318","X5319","X5400","X5410","X5420","X5441","X5451","X5500","X5510","X5512","X5530","X5534","X7210")
viljat<-c("X5853","X5831","X1211","X2190","X2195","X1140","X10","X1120","X1142","X1210","X1220","X1310","X1320","X1330","X1400","X1510","X1540","X1545","X1600","X1601","X1602","X1603","X1605","X1700","X1750","X1800","X1810","X1900")
mausteet<-c("X4800","X4810","X5152","X5806","X5824","X5842","X5843","X5846","X5850","X5851")
nurmet<-c("X6051","X2420","X2196","X2197","X9050","X9060","X9061","X9421","X94","X95","X90","X63","X60","X6050","X6060","X6111","X6112","X6113","X6114","X6121","X6122","X6123","X6124","X6125","X6210","X6220","X6221","X6230","X6300","X6301","X6302","X6400","X6402","X6542","X6545","X6550","X6561","X6562","X6563","X6565","X6600","X6700","X6710","X6720","X7110","X9100","X9101","X9102","X9110","X9111","X9400","X9401","X9402","X9403","X9404","X9405","X9406","X9407","X9408","X9412","X9413","X9422","X9423","X9424","X9430","X9440","X9460","X9600","X9620","X9700","X9710","X9720","X9801","X9810","X9811","X9812","X9800","X9820","X9802","X9803",	"X9804","X9805",	"X9806","X9807","X9808")
syysviljat<-c("X1110","X1141","X1230","X4120","X4220")
valkuais<-c("X2110","X2120","X2130","X2140","X2150","X2160","X2180","X2185","X2200","X2400","X2410","X2430","X2500","X2600","X5101","X5102")
oljy<-c("X4390","X4030","X4110","X4210","X4300","X4520","X4530","X4610","X4620","X8021")
#jos halutaan potentiaaliset neonikotinoidikasvit erikseen
neot<-c("X4110","X4120","X4210","X4220","X3210")
#valitaan ketjun perusteella sarakkeet ja lasketaan niistä summa uuden sarakkeen alle
data %>% dplyr::select(avomaavih) %>% rowSums(na.rm=TRUE) -> data$vege
data %>% dplyr::select(eitietoa) %>% rowSums(na.rm=TRUE) -> data$unkno
data %>% dplyr::select(erikois) %>% rowSums(na.rm=TRUE) -> data$spec
data %>% dplyr::select(marjat) %>% rowSums(na.rm=TRUE) -> data$fruit
data %>% dplyr::select(viljat) %>% rowSums(na.rm=TRUE) -> data$cere
data %>% dplyr::select(mausteet) %>% rowSums(na.rm=TRUE) -> data$herb
data %>% dplyr::select(nurmet) %>% rowSums(na.rm=TRUE) -> data$gras
data %>% dplyr::select(syysviljat) %>% rowSums(na.rm=TRUE) -> data$wint
data %>% dplyr::select(valkuais) %>% rowSums(na.rm=TRUE) -> data$prot
data %>% dplyr::select(oljy) %>% rowSums(na.rm=TRUE) -> data$oil
#neo erikseen
data %>% dplyr::select(neot) %>% rowSums(na.rm=TRUE) -> data$neo
#viljelykasvien keskimääräiset osuudet kaikilta vuosilta
osuudet<-colMeans(data[,15:248])
sp<-names(data[,15:248])
sp<- as.data.frame((cbind(sp,osuudet)),row.names = F)
sp$osuudet<-as.numeric(as.character(sp$osuudet))
#viljelykasvien pinta-alojen jakauma
ggplot(sp, aes(x=osuudet))+geom_histogram()
#yleisimmät viljelykasvit
sp %>%
top_n(10, osuudet)
#kasviryhmien keskimääräiset osuudet kaikilta vuosilta
colMeans(data[,251:260])
#jos halutaan vielä tiivistää viljelykasveja
data<-mutate(data, open = cere+vege+oil+prot) #pitäisikö vielä lisätä herb, fruit ja spec (ruokohelpi)? entäpä 9999?
data<-mutate(data, cover = gras+wint)
#muutetaan area neliökilometreiksi
data$area=data$area/1000000
data<-mutate(data, Abuild = build/area)
data<-mutate(data, Ariver = river/area)
data<-mutate(data, Astream = stream/area)
data<-mutate(data, Aroad = roads/area)
data<-dplyr::mutate(data, SSS = Abuild+Aroad+Ariver+Astream)
names(data)
data<-data[,c(1:2,4:5,7:8,12:13,249:250,261:268)]
#koordinaatit
koord=dplyr::select(koord,id,X,Y)
data<-left_join(data,koord,by="id")
names(data)
#poista aineistosta paikat, joilla ei ole kayty
data=data %>% drop_na("terri")
#tallennetaan
write.csv(data,"OrtolanBunting.csv",row.names = F)
data<-read.csv("OrtolanBunting.csv")
names(data)
str(data)
summary(data)
str(data)
#tarkasta kaikkien luokkien muoto
data$id<-as.factor(data$id)
#vuodelle oma faktori-muuttuja
data$fyear<-as.factor(data$year)
#outliers
dotchart(data$terri, main= "territories")
#outliers
dotchart(data$terri, main= "territories")
dotchart(data$prec, main= "precipitation")
#outliers
dotchart(data$terri, main= "territories")
dotchart(data$prec, main= "precipitation")
dotchart(data$temp, main= "temperature")
dotchart(data$open, main= "spring sown")
dotchart(data$SSS, main= "small-scale structures")
hist(data$terri)
hist(data$terri)
#kuinka monta käyntikertaa per osapopulaatio?
table(data$id)
#relationships
pairs.panels(data[,c(4:5,7,8,12,13,15,16,27:37)])
#relationships
pairs.panels(data[,c(43:21)])
#relationships
pairs.panels(data[,c(3:21)])
dataS=data %>%
mutate_at(c(2,3,5,6,7,9,10,11,12,13,18,19,20), funs(c(scale(.))))
dataS=data %>%
mutate_at(c(2,3,5,6,7,9,10,11,12,13,18,19,20), list(scale(.)))
dataS=data %>%
mutate_at(c(2,3,5,6,7,9,10,11,12,13,18,19,20), list(scale(.)))
dataS=data %>%
mutate_at(c(2,3,5,6,7,9,10,11,12,13,18,19,20), funs(c(scale(.))))
dataS=data %>%
mutate_at(c(2,3,5,6,7,9:18,19,20), funs(c(scale(.))))
M1=glmmTMB(terri ~ year + (1|fyear)+ (1|id), family=nbinom2, data=dataS)
M2=glmmTMB(terri ~ SSS + agri5 + X*Y + year + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M3=glmmTMB(terri ~ SSS + agri5 + X*Y + year*temp + year*prec  + (1|fyear)  + (1|id), family=nbinom2, data=dataS)
M4=glmmTMB(terri ~ SSS + agri5 + X*Y + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M4=glmmTMB(terri ~ SSS + agri5 + X*Y + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M5=glmmTMB(terri ~ SSS + agri5 + X*Y + year*temp + year*prec + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
output1<-model.sel(M1,M2,M3,M4,M5)
# AICc Table
output1
output2=model.sel(M4,M5)
#tehdään model averaging
output2=model.sel(M4,M5)
#tehdään model averaging
summary(M5)
summary(M5)
summary(M4)
#reviirien tiheys
dataS$terriD=dataS$terri/dataS$area
summary(dataS$terriD)
knitr::opts_chunk$set(echo = TRUE)
paketit<-c("readr","dplyr","vegan","ggplot2","tidyr")
lapply(paketit,library,character.only=T)
getwd()
localDir = "."
DataDir = file.path(localDir, "data")
filename1 = file.path(DataDir, "osapop_20002018.csv")
filename2= file.path(DataDir,"keskipisteiden_koordinaatit.csv")
data=read.csv(filename1, sep=";")
koord=read.csv(filename2, sep=";")
names(data)
head(koord)
#lisataan shannon-wiener muuttuja
data<-mutate(data, shan = diversity(data[,15:248],index="shannon"))
#lisataan shannon-wiener muuttuja
data<-mutate(data, shan = diversity(data[,15:249],index="shannon"))
#kasvilajien lukumaara
data<-mutate(data, snum= rowSums(data[,15:249]>0))
#listataan ensi mita muuttujia menee mihinkin ryhmaan
eitietoa<-c("X99999")
avomaavih<-c("X5148","X3210","X50","X55","X3110","X3120","X3130","X3140","X3150","X3160","X3180","X3190","X3310","X5100","X5103","X5104","X5105","X5106","X5107","X5108","X5109","X5111","X5112","X5113","X5115","X5116","X5117","X5119","X5120","X5121","X5124","X5125","X5128","X5129","X5134","X5140","X5143","X5146","X5149","X5150","X5157","X5165","X5173","X5197","X5198","X5816","X9630")
erikois<-c("X4900","X4901","X4902","X4903","X4904","X9640","X9642") #lähinnä ruokohelpi (4900)
marjat<-c("X5210","X5213","X5220","X5221","X5301","X5302","X5303","X5304","X5307","X5310","X5311","X5318","X5319","X5400","X5410","X5420","X5441","X5451","X5500","X5510","X5512","X5530","X5534","X7210")
viljat<-c("X5853","X5831","X1211","X2190","X2195","X1140","X10","X1120","X1142","X1210","X1220","X1310","X1320","X1330","X1400","X1510","X1540","X1545","X1600","X1601","X1602","X1603","X1605","X1700","X1750","X1800","X1810","X1900")
mausteet<-c("X4800","X4810","X5152","X5806","X5824","X5842","X5843","X5846","X5850","X5851")
nurmet<-c("X6051","X2420","X2196","X2197","X9050","X9060","X9061","X9421","X94","X95","X90","X63","X60","X6050","X6060","X6111","X6112","X6113","X6114","X6121","X6122","X6123","X6124","X6125","X6210","X6220","X6221","X6230","X6300","X6301","X6302","X6400","X6402","X6542","X6545","X6550","X6561","X6562","X6563","X6565","X6600","X6700","X6710","X6720","X7110","X9100","X9101","X9102","X9110","X9111","X9400","X9401","X9402","X9403","X9404","X9405","X9406","X9407","X9408","X9412","X9413","X9422","X9423","X9424","X9430","X9440","X9460","X9600","X9620","X9700","X9710","X9720","X9801","X9810","X9811","X9812","X9800","X9820","X9802","X9803",	"X9804","X9805",	"X9806","X9807","X9808")
syysviljat<-c("X1110","X1141","X1230","X4120","X4220")
valkuais<-c("X2110","X2120","X2130","X2140","X2150","X2160","X2180","X2185","X2200","X2400","X2410","X2430","X2500","X2600","X5101","X5102")
oljy<-c("X4390","X4030","X4110","X4210","X4300","X4520","X4530","X4610","X4620","X8021")
7+24+10+85+10+5+5+16+28
190+47
249-15
47+1+7+24+10+85+10+5+16+28
13*17
221+13
#listataan ensi mita muuttujia menee mihinkin ryhmaan
eitietoa<-c("X99999")
avomaavih<-c("X5148","X3210","X50","X55","X3110","X3120","X3130","X3140","X3150","X3160","X3180","X3190","X3310","X5100","X5103","X5104","X5105","X5106","X5107","X5108","X5109","X5111","X5112","X5113","X5115","X5116","X5117","X5119","X5120","X5121","X5124","X5125","X5128","X5129","X5134","X5140","X5143","X5146","X5149","X5150","X5157","X5165","X5173","X5197","X5198","X5816","X9630")
erikois<-c("X4900","X4901","X4902","X4903","X4904","X9640","X9642") #lähinnä ruokohelpi (4900)
marjat<-c("X5210","X5213","X5220","X5221","X5301","X5302","X5303","X5304","X5307","X5310","X5311","X5318","X5319","X5400","X5410","X5420","X5441","X5451","X5500","X5510","X5512","X5530","X5534","X7210")
viljat<-c("X5853","X5831","X1211","X2190","X2195","X1140","X10","X1120","X1142","X1210","X1220","X1310","X1320","X1330","X1400","X1510","X1540","X1545","X1600","X1601","X1602","X1603","X1605","X1700","X1750","X1800","X1810","X1900")
mausteet<-c("X4800","X4810","X5152","X5806","X5824","X5842","X5843","X5846","X5850","X5851")
nurmet<-c("X6051","X2420","X2196","X2197","X9050","X9060","X9061","X9421","X94","X95","X90","X63","X60","X6050","X6060","X6111","X6112","X6113","X6114","X6121","X6122","X6123","X6124","X6125","X6210","X6220","X6221","X6230","X6300","X6301","X6302","X6400","X6402","X6542","X6545","X6546","X6550","X6561","X6562","X6563","X6565","X6600","X6700","X6710","X6720","X7110","X9100","X9101","X9102","X9110","X9111","X9400","X9401","X9402","X9403","X9404","X9405","X9406","X9407","X9408","X9412","X9413","X9422","X9423","X9424","X9430","X9440","X9460","X9600","X9620","X9700","X9710","X9720","X9801","X9810","X9811","X9812","X9800","X9820","X9802","X9803",	"X9804","X9805",	"X9806","X9807","X9808")
syysviljat<-c("X1110","X1141","X1230","X4120","X4220")
valkuais<-c("X2110","X2120","X2130","X2140","X2150","X2160","X2180","X2185","X2200","X2400","X2410","X2430","X2500","X2600","X5101","X5102")
oljy<-c("X4390","X4030","X4110","X4210","X4300","X4520","X4530","X4610","X4620","X8021")
#jos halutaan potentiaaliset neonikotinoidikasvit erikseen
neot<-c("X4110","X4120","X4210","X4220","X3210")
#valitaan ketjun perusteella sarakkeet ja lasketaan niistä summa uuden sarakkeen alle
data %>% dplyr::select(avomaavih) %>% rowSums(na.rm=TRUE) -> data$vege
data %>% dplyr::select(eitietoa) %>% rowSums(na.rm=TRUE) -> data$unkno
data %>% dplyr::select(erikois) %>% rowSums(na.rm=TRUE) -> data$spec
data %>% dplyr::select(marjat) %>% rowSums(na.rm=TRUE) -> data$fruit
data %>% dplyr::select(viljat) %>% rowSums(na.rm=TRUE) -> data$cere
data %>% dplyr::select(mausteet) %>% rowSums(na.rm=TRUE) -> data$herb
data %>% dplyr::select(nurmet) %>% rowSums(na.rm=TRUE) -> data$gras
data %>% dplyr::select(syysviljat) %>% rowSums(na.rm=TRUE) -> data$wint
data %>% dplyr::select(valkuais) %>% rowSums(na.rm=TRUE) -> data$prot
data %>% dplyr::select(oljy) %>% rowSums(na.rm=TRUE) -> data$oil
#neo erikseen
data %>% dplyr::select(neot) %>% rowSums(na.rm=TRUE) -> data$neo
#viljelykasvien keskimääräiset osuudet kaikilta vuosilta
osuudet<-colMeans(data[,15:248])
sp<-names(data[,15:248])
sp<- as.data.frame((cbind(sp,osuudet)),row.names = F)
sp$osuudet<-as.numeric(as.character(sp$osuudet))
#viljelykasvien pinta-alojen jakauma
ggplot(sp, aes(x=osuudet))+geom_histogram()
#yleisimmät viljelykasvit
sp %>%
top_n(10, osuudet)
names(data)
#kasviryhmien keskimääräiset osuudet kaikilta vuosilta
colMeans(data[,251:260])
#jos halutaan vielä tiivistää viljelykasveja
data<-mutate(data, open = cere+vege+oil+prot) #pitäisikö vielä lisätä herb, fruit ja spec (ruokohelpi)? entäpä 9999?
data<-mutate(data, cover = gras+wint)
#muutetaan pinta-ala neliökilometreiksi
data$area=data$area/1000000
data<-mutate(data, Abuild = build/area)
data<-mutate(data, Ariver = river/area)
data<-mutate(data, Astream = stream/area)
data<-mutate(data, Aroad = roads/area)
data<-dplyr::mutate(data, SSS = Abuild+Aroad+Ariver+Astream)
data<-dplyr::mutate(data, SSS = Abuild+Aroad+Ariver+Astream)
names(data)
data<-data[,c(1:2,4:5,7:8,12:13,249:250,261:268)]
koord=dplyr::select(koord,id,X,Y)
data<-left_join(data,koord,by="id")
names(data)
data=data %>% drop_na("terri")
write.csv(data,"OrtolanBunting.csv",row.names = F)
getwd()
paketit<-c("readr","tidyr","plyr","dplyr","vegan","ggplot2","lattice","psych","glmmTMB","lme4","MASS","MuMIn","mgcv")
lapply(paketit,library,character.only=T)
data<-read.csv("OrtolanBunting.csv")
names(data)
str(data)
summary(data)
#tarkasta kaikkien luokkien muoto
data$id<-as.factor(data$id)
#vuodelle oma faktori-muuttuja
data$fyear<-as.factor(data$year)
#outliers
dotchart(data$terri, main= "territories")
dotchart(data$prec, main= "precipitation")
dotchart(data$temp, main= "temperature")
dotchart(data$open, main= "spring sown")
dotchart(data$SSS, main= "small-scale structures")
hist(data$terri)
#kuinka monta käyntikertaa per osapopulaatio?
table(data$id)
#relationships
pairs.panels(data[,c(3:21)])
knitr::opts_chunk$set(echo = TRUE)
paketit<-c("readr","dplyr","vegan","ggplot2","tidyr")
lapply(paketit,library,character.only=T)
getwd()
localDir = "."
DataDir = file.path(localDir, "data")
filename1 = file.path(DataDir, "osapop_20002018.csv")
filename2= file.path(DataDir,"keskipisteiden_koordinaatit.csv")
data=read.csv(filename1, sep=";")
koord=read.csv(filename2, sep=";")
names(data)
head(koord)
#lisataan shannon-wiener muuttuja
data<-mutate(data, shan = diversity(data[,15:248],index="shannon"))
#kasvilajien lukumaara
data<-mutate(data, snum= rowSums(data[,15:248]>0))
#listataan ensi mita muuttujia menee mihinkin ryhmaan
eitietoa<-c("X99999")
avomaavih<-c("X5148","X3210","X50","X55","X3110","X3120","X3130","X3140","X3150","X3160","X3180","X3190","X3310","X5100","X5103","X5104","X5105","X5106","X5107","X5108","X5109","X5111","X5112","X5113","X5115","X5116","X5117","X5119","X5120","X5121","X5124","X5125","X5128","X5129","X5134","X5140","X5143","X5146","X5149","X5150","X5157","X5165","X5173","X5197","X5198","X5816","X9630")
erikois<-c("X4900","X4901","X4902","X4903","X4904","X9640","X9642") #lähinnä ruokohelpi (4900)
marjat<-c("X5210","X5213","X5220","X5221","X5301","X5302","X5303","X5304","X5307","X5310","X5311","X5318","X5319","X5400","X5410","X5420","X5441","X5451","X5500","X5510","X5512","X5530","X5534","X7210")
viljat<-c("X5853","X5831","X1211","X2190","X2195","X1140","X10","X1120","X1142","X1210","X1220","X1310","X1320","X1330","X1400","X1510","X1540","X1545","X1600","X1601","X1602","X1603","X1605","X1700","X1750","X1800","X1810","X1900")
mausteet<-c("X4800","X4810","X5152","X5806","X5824","X5842","X5843","X5846","X5850","X5851")
nurmet<-c("X6051","X2420","X2196","X2197","X9050","X9060","X9061","X9421","X94","X95","X90","X63","X60","X6050","X6060","X6111","X6112","X6113","X6114","X6121","X6122","X6123","X6124","X6125","X6210","X6220","X6221","X6230","X6300","X6301","X6302","X6400","X6402","X6542","X6545","X6546","X6550","X6561","X6562","X6563","X6565","X6600","X6700","X6710","X6720","X7110","X9100","X9101","X9102","X9110","X9111","X9400","X9401","X9402","X9403","X9404","X9405","X9406","X9407","X9408","X9412","X9413","X9422","X9423","X9424","X9430","X9440","X9460","X9600","X9620","X9700","X9710","X9720","X9801","X9810","X9811","X9812","X9800","X9820","X9802","X9803",	"X9804","X9805",	"X9806","X9807","X9808")
syysviljat<-c("X1110","X1141","X1230","X4120","X4220")
valkuais<-c("X2110","X2120","X2130","X2140","X2150","X2160","X2180","X2185","X2200","X2400","X2410","X2430","X2500","X2600","X5101","X5102")
oljy<-c("X4390","X4030","X4110","X4210","X4300","X4520","X4530","X4610","X4620","X8021")
#jos halutaan potentiaaliset neonikotinoidikasvit erikseen
neot<-c("X4110","X4120","X4210","X4220","X3210")
#valitaan ketjun perusteella sarakkeet ja lasketaan niistä summa uuden sarakkeen alle
data %>% dplyr::select(avomaavih) %>% rowSums(na.rm=TRUE) -> data$vege
data %>% dplyr::select(eitietoa) %>% rowSums(na.rm=TRUE) -> data$unkno
data %>% dplyr::select(erikois) %>% rowSums(na.rm=TRUE) -> data$spec
data %>% dplyr::select(marjat) %>% rowSums(na.rm=TRUE) -> data$fruit
data %>% dplyr::select(viljat) %>% rowSums(na.rm=TRUE) -> data$cere
data %>% dplyr::select(mausteet) %>% rowSums(na.rm=TRUE) -> data$herb
data %>% dplyr::select(nurmet) %>% rowSums(na.rm=TRUE) -> data$gras
data %>% dplyr::select(syysviljat) %>% rowSums(na.rm=TRUE) -> data$wint
data %>% dplyr::select(valkuais) %>% rowSums(na.rm=TRUE) -> data$prot
data %>% dplyr::select(oljy) %>% rowSums(na.rm=TRUE) -> data$oil
#neo erikseen
data %>% dplyr::select(neot) %>% rowSums(na.rm=TRUE) -> data$neo
#viljelykasvien keskimääräiset osuudet kaikilta vuosilta
osuudet<-colMeans(data[,15:248])
sp<-names(data[,15:248])
sp<- as.data.frame((cbind(sp,osuudet)),row.names = F)
sp$osuudet<-as.numeric(as.character(sp$osuudet))
#viljelykasvien pinta-alojen jakauma
ggplot(sp, aes(x=osuudet))+geom_histogram()
#yleisimmät viljelykasvit
sp %>%
top_n(10, osuudet)
#kasviryhmien keskimääräiset osuudet kaikilta vuosilta
colMeans(data[,251:260])
#jos halutaan vielä tiivistää viljelykasveja
data<-mutate(data, open = cere+vege+oil+prot) #pitäisikö vielä lisätä herb, fruit ja spec (ruokohelpi)? entäpä 9999?
data<-mutate(data, cover = gras+wint)
#muutetaan pinta-ala neliökilometreiksi
data$area=data$area/1000000
data<-mutate(data, Abuild = build/area)
data<-mutate(data, Ariver = river/area)
data<-mutate(data, Astream = stream/area)
data<-mutate(data, Aroad = roads/area)
data<-dplyr::mutate(data, SSS = Abuild+Aroad+Ariver+Astream)
names(data)
data<-data[,c(1:2,4:5,7:8,12:13,249:250,261:268)]
koord=dplyr::select(koord,id,X,Y)
data<-left_join(data,koord,by="id")
names(data)
data=data %>% drop_na("terri")
write.csv(data,"OrtolanBunting.csv",row.names = F)
getwd()
paketit<-c("readr","tidyr","plyr","dplyr","vegan","ggplot2","lattice","psych","glmmTMB","lme4","MASS","MuMIn","mgcv")
lapply(paketit,library,character.only=T)
data<-read.csv("OrtolanBunting.csv")
names(data)
str(data)
summary(data)
#tarkasta kaikkien luokkien muoto
data$id<-as.factor(data$id)
#vuodelle oma faktori-muuttuja
data$fyear<-as.factor(data$year)
#outliers
dotchart(data$terri, main= "territories")
dotchart(data$prec, main= "precipitation")
dotchart(data$temp, main= "temperature")
dotchart(data$open, main= "spring sown")
dotchart(data$SSS, main= "small-scale structures")
hist(data$terri)
#kuinka monta käyntikertaa per osapopulaatio?
table(data$id)
#relationships
pairs.panels(data[,c(3:21)])
#plottailua
xyplot(terri~fyear|id, data=data)
boxplot(terri~fyear, data=data)
boxplot(terri~id, data=data)
xyplot(terri~SSS, data=data)
xyplot(terri~open, data=data)
xyplot(terri~cover, data=data)
#Aksun esimerkit (näissä mukana NDVI):
#m1=glmmTMB(N ~Year + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m2=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m3=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Temp + Year*Rain + Year*NDVI + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m4=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Cropdiv + Year*Plough + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m5=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Temp + Year*Rain + Year*NDVI + Year*Cropdiv + Year*Plough + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
dataS=data %>%
mutate_at(c(2:3,5:7,9:20), funs(c(scale(.))))
M1=glmmTMB(terri ~ year + (1|fyear)+ (1|id), family=nbinom2, data=dataS)
M2=glmmTMB(terri ~ SSS + agri5 + X*Y + year + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M3=glmmTMB(terri ~ SSS + agri5 + X*Y + year*temp + year*prec  + (1|fyear)  + (1|id), family=nbinom2, data=dataS)
M4=glmmTMB(terri ~ SSS + agri5 + X*Y + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M5=glmmTMB(terri ~ SSS + agri5 + X*Y + year*temp + year*prec + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
output1<-model.sel(M1,M2,M3,M4,M5)
# AICc Table
output1
output2=model.sel(M4,M5)
#tehdään model averaging
summary(model.avg(output2, revised.var = TRUE))
summary(M5)
summary(M4)
getwd()
paketit<-c("readr","tidyr","plyr","dplyr","vegan","ggplot2","lattice","psych","glmmTMB","lme4","MASS","MuMIn","mgcv")
lapply(paketit,library,character.only=T)
data<-read.csv("OrtolanBunting.csv")
names(data)
str(data)
summary(data)
#tarkasta kaikkien luokkien muoto
data$id<-as.factor(data$id)
#vuodelle oma faktori-muuttuja
data$fyear<-as.factor(data$year)
#outliers
dotchart(data$terri, main= "territories")
dotchart(data$prec, main= "precipitation")
dotchart(data$temp, main= "temperature")
dotchart(data$open, main= "spring sown")
#reviirien tiheys
dataS$terriD=dataS$terri/dataS$area
summary(dataS$terriD)
